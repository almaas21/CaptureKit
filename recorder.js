import{a as et,r as T,G as we,c as ke,l as tt,C as nt,b as $,o as B,e as l,t as N,F as ot,i as Ce,u as rt,y as ae,A as Se,n as ie,m as at,f as it,B as st,p as lt,q as ct}from"./chunks/main-Bu1yZWFu.js";import{_ as dt}from"./chunks/webchatagent-D4SWolo5.js";const ut="modulepreload",mt=function(se){return"/"+se},Re={},ht=function(I,i,le){let G=Promise.resolve();if(i&&i.length>0){let te=function(x){return Promise.all(x.map(S=>Promise.resolve(S).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};document.getElementsByTagName("link");const _=document.querySelector("meta[property=csp-nonce]"),P=_?.nonce||_?.getAttribute("nonce");G=te(i.map(x=>{if(x=mt(x),x in Re)return;Re[x]=!0;const S=x.endsWith(".css"),k=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${x}"]${k}`))return;const y=document.createElement("link");if(y.rel=S?"stylesheet":ut,S||(y.as="script"),y.crossOrigin="",y.href=x,P&&y.setAttribute("nonce",P),document.head.appendChild(y),S)return new Promise((O,M)=>{y.addEventListener("load",O),y.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${x}`)))})}))}function j(_){const P=new Event("vite:preloadError",{cancelable:!0});if(P.payload=_,window.dispatchEvent(P),!P.defaultPrevented)throw _}return G.then(_=>{for(const P of _||[])P.status==="rejected"&&j(P.reason);return I().catch(j)})},gt={class:"min-h-screen bg-zinc-900 flex flex-col"},pt={key:0,class:"flex-1 flex items-center justify-center p-4"},ft={class:"text-center space-y-3"},vt={class:"text-red-500"},wt={class:"relative w-full h-full overflow-visible"},xt={class:"w-full h-full rounded-full overflow-hidden shadow-xl"},yt={class:"p-4 space-y-4 bg-zinc-800 border-t border-zinc-700"},bt={class:"flex items-center justify-center gap-3"},Pt={class:"text-4xl font-mono text-white tabular-nums"},Mt={class:"flex flex-wrap justify-center gap-2 text-xs"},kt={class:"px-2 py-1 bg-zinc-700 rounded-full text-zinc-300"},Ct={class:"px-2 py-1 bg-zinc-700 rounded-full text-zinc-300"},St={key:2,class:"flex-1 flex items-center justify-center p-4"},Rt=15,ee=256,It=et({__name:"App",setup(se){const I=new URLSearchParams(window.location.search),i={captureMode:I.get("mode")||"tab",systemAudio:I.get("audio")==="true",microphone:I.get("mic")==="true",camera:I.get("camera")==="true",quality:I.get("quality")||"1080p",backgroundMode:I.get("backgroundMode")||"none",backgroundColor:I.get("backgroundColor")||"#00ff00",backgroundImage:I.get("backgroundImage")||void 0},le=T(!1),G=T(0),j=T(""),_=T(""),P=T(null),te=T(null),x=T(null),S=T(null),k=T("unknown");let y=null,O=null,M=null,ne=null,U=null,ce=[],de=0,ue=null,W=null,V=null,w=null,E=null,C=null,R=null,q=null,xe=[],_e="VIDEO",z=null,D=null,Y=null,H=null,Q=0,Z=0,me=0,J=null;const p=we({cx:.88,cy:.82,r:i.quality==="4k"?.16:.14}),A=we({w:0,h:0});function b(t,e,n){return Math.min(n,Math.max(e,t))}function he(){return Math.max(1,Math.min(A.w,A.h))}function X(){const t=he(),e=40,n=t*.45;return b(p.r*t,e,n)}const Ee=ke(()=>{const e=X()*2,n=b(e*.12,16,28);return{width:`${n}px`,height:`${n}px`}});function ge(){const t=A.w,e=A.h;if(t<=0||e<=0)return;const n=X(),r=b(p.cx*t,n,t-n),o=b(p.cy*e,n,e-n);p.cx=r/t,p.cy=o/e}const Ae=ke(()=>{const t=A.w,e=A.h,n=X(),r=n*2;if(t<=0||e<=0)return{left:"auto",top:"auto",right:"1rem",bottom:"1rem",width:"112px",height:"112px"};const o=b(p.cx*t,n,t-n),u=b(p.cy*e,n,e-n),m=o-n,v=u-n;return{left:`${m}px`,top:`${v}px`,width:`${r}px`,height:`${r}px`}}),c=we({mode:null,pointerId:null,startClientX:0,startClientY:0,startCx:0,startCy:0,startR:0});function L(){const t=S.value;if(!t)return;const e=t.getBoundingClientRect();if(A.w=Math.max(1,e.width),A.h=Math.max(1,e.height),ge(),y)try{y.observe(t)}catch{}}function De(t){t.button===0&&(L(),c.mode="move",c.pointerId=t.pointerId,c.startClientX=t.clientX,c.startClientY=t.clientY,c.startCx=p.cx,c.startCy=p.cy,c.startR=p.r,t.currentTarget?.setPointerCapture?.(t.pointerId))}function Fe(t){t.button===0&&(L(),c.mode="resize",c.pointerId=t.pointerId,c.startClientX=t.clientX,c.startClientY=t.clientY,c.startCx=p.cx,c.startCy=p.cy,c.startR=p.r,t.currentTarget?.setPointerCapture?.(t.pointerId))}function Te(t){if(!c.mode||c.pointerId!==t.pointerId)return;const e=A.w,n=A.h;if(e<=0||n<=0)return;const r=he(),o=40,u=r*.45;if(c.mode==="move"){const s=t.clientX-c.startClientX,d=t.clientY-c.startClientY,h=c.startCx*e+s,f=c.startCy*n+d,g=X();p.cx=b(h,g,e-g)/e,p.cy=b(f,g,n-g)/n;return}const m=Math.max(t.clientX-c.startClientX,t.clientY-c.startClientY),v=b(c.startR*r,o,u),a=b(v+m,o,u);p.r=a/r,ge()}function ye(t){c.pointerId===t.pointerId&&(c.mode=null,c.pointerId=null)}function Oe(t){L();const e=he(),n=40,r=e*.45,o=X(),u=b(o+(t.deltaY>0?-10:10),n,r);p.r=u/e,ge()}function Ue(t){switch(t){case"4k":return{width:3840,height:2160,bitrate:15e6};case"1080p":return{width:1920,height:1080,bitrate:8e6};default:return{width:1280,height:720,bitrate:4e6}}}function ze(t){const e=Math.floor(t/60),n=Math.floor(t%60);return`${e.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}async function Le(){try{const e=await import("/vision_bundle.mjs");let n,r;if(e.vision?.ImageSegmenter&&e.fileset_resolver?.FilesetResolver?(n=e.vision.ImageSegmenter,r=e.fileset_resolver.FilesetResolver):e.default?.vision?.ImageSegmenter&&e.default?.fileset_resolver?.FilesetResolver?(n=e.default.vision.ImageSegmenter,r=e.default.fileset_resolver.FilesetResolver):window.vision?.ImageSegmenter&&window.fileset_resolver?.FilesetResolver?(n=window.vision.ImageSegmenter,r=window.fileset_resolver.FilesetResolver):(n=e.ImageSegmenter||e.default?.ImageSegmenter,r=e.FilesetResolver||e.default?.FilesetResolver),!n||!r)throw new Error("Failed to load ImageSegmenter or FilesetResolver from vision bundle");const o=await r.forVisionTasks("/wasm");let m={baseOptions:{modelAssetPath:await Ne(),delegate:"GPU"},runningMode:_e,outputCategoryMask:!0,outputConfidenceMasks:!1};try{q=await n.createFromOptions(o,m),k.value="GPU"}catch{m.baseOptions.delegate="CPU",q=await n.createFromOptions(o,m),k.value="CPU"}return xe=q.getLabels(),J=je(xe),!0}catch{return k.value="unknown",!1}}function $e(){return i.backgroundImage&&i.backgroundMode==="image"?(z=new Image,z.src=i.backgroundImage,new Promise((t,e)=>{z.onload=()=>t(),z.onerror=()=>e(new Error("Failed to load background image"))})):Promise.resolve()}function Be(){D&&Y||(D=document.createElement("canvas"),D.width=ee,D.height=ee,Y=D.getContext("2d",{alpha:!0,willReadFrequently:!0}))}async function Ne(){const t=["/selfie_multiclass_256x256.tflite","/selfie_segmenter.tflite","/deeplab_v3.tflite"];for(const e of t)try{if((await fetch(e,{method:"HEAD"})).ok)return e}catch{}return"/deeplab_v3.tflite"}function je(t){const e=t.map(o=>(o??"").toLowerCase());if(e.length>=6&&e[0]==="background"&&e.includes("hair")&&(e.includes("clothes")||e.includes("accessories")||e.includes("others")))return o=>o!==0;const r=e.findIndex(o=>o==="person"||o.includes("person"));return r>=0?o=>o===r:o=>o!==0}function be(t,e){const n=Math.min(t,e),r=Math.floor((t-n)/2),o=Math.floor((e-n)/2);return{sx:r,sy:o,sSize:n}}function Ve(t,e,n){const r=t.videoWidth||640,o=t.videoHeight||480,{sx:u,sy:m,sSize:v}=be(r,o);e.clearRect(0,0,n,n),e.drawImage(t,u,m,v,v,0,0,n,n)}function qe(t,e,n,r,o){const u=t.getImageData(0,0,e,e),m=u.data;if(r===e&&o===e&&n.length===e*e)for(let a=0;a<n.length;a++){const s=n[a]??0,d=J?J(s):s!==0;m[a*4+3]=d?255:0}else for(let a=0;a<e;a++){const s=Math.min(o-1,Math.floor(a*o/e));for(let d=0;d<e;d++){const h=Math.min(r-1,Math.floor(d*r/e)),f=s*r+h,g=(a*e+d)*4+3,K=n[f]??0,oe=J?J(K):K!==0;m[g]=oe?255:0}}t.putImageData(u,0,0)}function Ye(t,e,n,r,o){const u=e.width,m=e.height;if(!u||!m)return;const v=u/m,a=1;let s=o,d=o,h=n,f=r;v>a?(d=o,s=o*v,h=n+(o-s)/2):(s=o,d=o/v,f=r+(o-d)/2),t.drawImage(e,h,f,s,d)}function Pe(t,e,n,r,o,u){if(i.backgroundMode==="none"||!q){const s=t.videoWidth||640,d=t.videoHeight||480,{sx:h,sy:f,sSize:g}=be(s,d);e.drawImage(t,h,f,g,g,n,r,o,o);return}if(Be(),!D||!Y)return;Ve(t,Y,ee);const m=performance.now(),v=1e3/Rt;if(!H||m-me>=v)try{q.segmentForVideo(D,m,s=>{try{if(s?.categoryMask){const d=s.categoryMask.getAsUint8Array(),h=s.categoryMask.width??0,f=s.categoryMask.height??0,g=Math.round(Math.sqrt(d?.length??0));Q=Number.isFinite(h)&&h>0?h:g,Z=Number.isFinite(f)&&f>0?f:g,d&&Q>0&&Z>0&&d.length===Q*Z&&(H=d,me=m)}}catch{}})}catch{}if(H&&Q>0&&Z>0&&qe(Y,ee,H,Q,Z),e.save(),i.backgroundMode==="color"){const s=Xe(i.backgroundColor);s&&(e.fillStyle=`rgb(${s.r}, ${s.g}, ${s.b})`,e.fillRect(n,r,o,o))}else i.backgroundMode==="image"&&z&&z.complete&&Ye(e,z,n,r,o);e.drawImage(D,n,r,o,o),e.restore()}function Xe(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e&&e[1]&&e[2]&&e[3]?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}async function Ge(){try{const t=Ue(i.quality);i.camera&&i.backgroundMode!=="none"&&(await Le(),await $e());try{M=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:t.width},height:{ideal:t.height}},audio:i.systemAudio?{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:2,sampleRate:48e3}:!1})}catch{M=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:t.width},height:{ideal:t.height}},audio:i.systemAudio})}const e=M.getVideoTracks()[0];if(e){const a=e.getSettings();_.value=`${a.width||"?"}Ã—${a.height||"?"}`}if(i.microphone)try{ne=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0}})}catch{}if(i.camera)try{U=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user"},audio:!1})}catch{}let n;if(U){C=document.createElement("video"),C.srcObject=M,C.muted=!0,C.playsInline=!0,R=document.createElement("video"),R.srcObject=U,R.muted=!0,R.playsInline=!0,await new Promise(h=>{C.onloadedmetadata=()=>h(),C.play()}),R.play();const a=C.videoWidth||t.width,s=C.videoHeight||t.height;w=document.createElement("canvas"),w.width=a,w.height=s,E=w.getContext("2d"),await new Promise(h=>{const f=()=>{C.readyState>=2&&R.readyState>=2?h():requestAnimationFrame(f)};f()});const d=()=>{if(!E||!w||!C||!R)return;E.drawImage(C,0,0,w.width,w.height);const h=Math.round(w.width*.02),f=Math.max(1,Math.min(w.width,w.height)),g=Math.round(b(p.r*f,80,f*.45)),K=Math.round(b(p.cx*w.width,g+h,w.width-g-h)),oe=Math.round(b(p.cy*w.height,g+h,w.height-g-h));E.save(),E.beginPath(),E.arc(K,oe,g,0,Math.PI*2),E.clip();const Qe=g*2,Ze=K-g,Je=oe-g;Pe(R,E,Ze,Je,Qe,!1),E.restore();const F=te.value;if(F&&R){const Ke=X(),re=Math.round(b(Ke*2,64,ee));F.width!==re&&(F.width=re),F.height!==re&&(F.height=re);const ve=F.getContext("2d",{alpha:!0});ve&&(ve.clearRect(0,0,F.width,F.height),Pe(R,ve,0,0,F.width,!1))}W=requestAnimationFrame(d)};d(),n=w.captureStream(30)}else n=new MediaStream(M.getVideoTracks());const r=[...n.getVideoTracks()],o=M.getAudioTracks(),u=ne?.getAudioTracks()??[];if(o.length>0&&u.length===0)r.push(...o);else if(o.length===0&&u.length>0)r.push(...u);else if(o.length>0&&u.length>0)try{V=new AudioContext({sampleRate:48e3});const a=V.createMediaStreamDestination();V.createMediaStreamSource(new MediaStream(o)).connect(a),V.createMediaStreamSource(new MediaStream(u)).connect(a),r.push(...a.stream.getAudioTracks())}catch{r.push(...o)}const m=new MediaStream(r),v=MediaRecorder.isTypeSupported("video/webm;codecs=vp9,opus")?"video/webm;codecs=vp9,opus":"video/webm";O=new MediaRecorder(m,{mimeType:v,videoBitsPerSecond:t.bitrate,audioBitsPerSecond:256e3}),ce=[],O.ondataavailable=a=>{a.data.size>0&&ce.push(a.data)},O.onstop=async()=>{ue&&clearInterval(ue),W&&cancelAnimationFrame(W);const a=new Blob(ce,{type:v}),s=(Date.now()-de)/1e3;fe(),chrome.runtime.sendMessage({type:"RECORDING_STOPPED"}),await We(a,s)},M.getVideoTracks()[0]?.addEventListener("ended",pe),O.start(1e3),de=Date.now(),le.value=!0,chrome.runtime.sendMessage({type:"RECORDING_STARTED"}),await st(),L(),await new Promise(a=>setTimeout(a,100)),x.value&&M&&(x.value.srcObject=M,await x.value.play().catch(()=>{})),P.value&&U&&i.backgroundMode==="none"&&(P.value.srcObject=U,await P.value.play().catch(()=>{})),ue=window.setInterval(()=>{G.value=Math.floor((Date.now()-de)/1e3)},1e3)}catch(t){j.value=t instanceof Error?t.message:"Failed",fe()}}function pe(){O?.state==="recording"&&O.stop()}function fe(){W&&cancelAnimationFrame(W),M?.getTracks().forEach(t=>t.stop()),ne?.getTracks().forEach(t=>t.stop()),U?.getTracks().forEach(t=>t.stop()),V?.close().catch(()=>{}),V=null,M=null,ne=null,U=null,C=null,R=null,w=null,E=null,q=null,z=null,D=null,Y=null,H=null,me=0}async function We(t,e){const{saveRecording:n}=await ht(async()=>{const{saveRecording:o}=await import("./chunks/indexeddb-BQXE7YLk.js");return{saveRecording:o}},[]),r=await n(t,e);chrome.tabs.create({url:chrome.runtime.getURL(`editor.html?id=${r}`)}),window.close()}function Me(t){t.type==="STOP_RECORDING"&&pe()}tt(()=>{chrome.runtime.onMessage.addListener(Me),Ge(),L(),window.addEventListener("resize",L),typeof ResizeObserver<"u"&&(y=new ResizeObserver(()=>L()),S.value&&y.observe(S.value))}),nt(()=>{chrome.runtime.onMessage.removeListener(Me),fe(),window.removeEventListener("resize",L),y?.disconnect(),y=null});function He(){window.close()}return(t,e)=>(B(),$("div",gt,[j.value?(B(),$("div",pt,[l("div",ft,[l("p",vt,N(j.value),1),l("button",{onClick:He,class:"px-4 py-2 bg-zinc-700 text-white rounded-lg"}," Close ")])])):le.value?(B(),$(ot,{key:1},[l("div",{ref_key:"screenPreviewContainer",ref:S,class:"flex-1 relative bg-black p-2 min-h-0"},[l("video",{ref_key:"screenPreview",ref:x,class:"w-full h-full object-contain rounded-lg",muted:"",playsinline:""},null,512),e[0]||(e[0]=l("div",{class:"absolute top-4 left-4 flex items-center gap-2 px-3 py-1.5 bg-red-500/90 rounded-full"},[l("div",{class:"w-2 h-2 rounded-full bg-white animate-pulse"}),l("span",{class:"text-xs font-bold text-white"},"REC")],-1)),i.camera&&rt(U)?(B(),$("div",{key:0,class:"absolute touch-none select-none",style:Se(Ae.value),onPointerdown:ae(De,["prevent"]),onPointermove:ae(Te,["prevent"]),onPointerup:ye,onPointercancel:ye,onWheel:ae(Oe,["prevent"])},[l("div",wt,[l("div",xt,[i.backgroundMode==="none"?(B(),$("video",{key:0,ref_key:"cameraPreview",ref:P,class:"w-full h-full object-cover",muted:"",playsinline:""},null,512)):(B(),$("canvas",{key:1,ref_key:"cameraPreviewCanvasEl",ref:te,class:"w-full h-full"},null,512))]),l("div",{class:"absolute -bottom-1 -right-1 z-20 rounded bg-white/85 border border-black/50 shadow-xl ring-2 ring-black/40 cursor-nwse-resize",style:Se(Ee.value),onPointerdown:ae(Fe,["stop","prevent"])},null,36)])],36)):Ce("",!0)],512),l("div",yt,[l("div",bt,[e[1]||(e[1]=l("div",{class:"w-3 h-3 rounded-full bg-red-500 animate-pulse"},null,-1)),l("span",Pt,N(ze(G.value)),1)]),l("div",Mt,[l("span",kt," ðŸ“º "+N(_.value||"Loading..."),1),l("span",Ct," ðŸŽ¬ "+N(i.captureMode==="tab"?"Tab":"Screen"),1),l("span",{class:ie(["px-2 py-1 rounded-full",i.systemAudio?"bg-green-600/30 text-green-400":"bg-zinc-700 text-zinc-500"])}," ðŸ”Š Audio "+N(i.systemAudio?"ON":"OFF"),3),l("span",{class:ie(["px-2 py-1 rounded-full",i.microphone?"bg-green-600/30 text-green-400":"bg-zinc-700 text-zinc-500"])}," ðŸŽ¤ Mic "+N(i.microphone?"ON":"OFF"),3),l("span",{class:ie(["px-2 py-1 rounded-full",i.camera?"bg-green-600/30 text-green-400":"bg-zinc-700 text-zinc-500"])}," ðŸ“· Cam "+N(i.camera?"ON":"OFF"),3),i.camera&&i.backgroundMode!=="none"?(B(),$("span",{key:0,class:ie(["px-2 py-1 rounded-full",k.value==="GPU"?"bg-indigo-600/30 text-indigo-300":k.value==="CPU"?"bg-amber-600/30 text-amber-300":"bg-zinc-700 text-zinc-400"])}," ðŸ§  Seg "+N(k.value.toUpperCase()),3)):Ce("",!0)]),l("button",{onClick:pe,class:"w-full py-3 bg-red-500 hover:bg-red-600 text-white font-bold rounded-xl flex items-center justify-center gap-2 transition-colors"},[...e[2]||(e[2]=[l("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[l("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})],-1),at(" Stop Recording ",-1)])]),e[3]||(e[3]=l("p",{class:"text-center text-xs text-zinc-500"},' Or click "Stop sharing" in the browser toolbar ',-1)),e[4]||(e[4]=l("a",{href:"https://webchatagent.com/?ref=screenrecorder",target:"_blank",class:"flex items-center justify-center gap-2 p-2.5 bg-linear-to-r from-indigo-500/10 to-purple-500/10 border border-indigo-500/20 rounded-lg hover:border-indigo-500/40 transition-all group"},[l("img",{src:dt,alt:"WebChatAgent",class:"w-5 h-5 rounded"}),l("span",{class:"text-xs text-zinc-400 group-hover:text-indigo-300 transition-colors"}," AI Chatbot & Live Chat for your Website ")],-1))])],64)):(B(),$("div",St,[...e[5]||(e[5]=[it('<div class="text-center"><div class="w-10 h-10 mx-auto mb-2"><svg class="animate-spin text-red-500" viewBox="0 0 24 24" fill="none"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg></div><p class="text-zinc-400 text-sm">Starting recording...</p></div>',1)])]))]))}}),_t=lt(),Ie=ct(It);Ie.use(_t);Ie.mount("#app");
